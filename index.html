<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Raven’s Dox2 Trait Planner</title>
<style>
:root {
  --bg-color: #f0f0f0;
  --section-bg: #fff;
  --result-bg: #cfe0ff;
  --sticky-bg: #e0e0ff;
  --text-color: #000;
}

body { 
  font-family: Arial, sans-serif; 
  padding: 20px; 
  background: var(--bg-color); 
  color: var(--text-color); 
  margin:0; 
}

h1 { text-align:center; font-size:36px; margin-bottom:10px; }
h2 { font-size:28px; margin-top:0; }

.section { 
  background: var(--section-bg); 
  padding:20px; 
  margin-bottom:20px; 
  border-radius:8px; 
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
label { display:block; margin-top:10px; font-size:20px; }
select, input[type=number] { margin:10px 0; padding:10px; width:100%; font-size:20px; }

.sticky-header {
  position: sticky;
  top: 0;
  background: var(--sticky-bg);
  padding: 15px 20px;
  z-index: 999;
  border-bottom: 2px solid #999;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.result { 
  background: var(--result-bg); 
  padding:15px; 
  border-radius:5px; 
  margin-top:10px; 
  font-weight:bold; 
  font-size:24px; 
}
.warning { color:red; font-weight:bold; }

.flex-row { display:flex; gap:10px; flex-wrap:wrap; }
.flex-row select, .flex-row input[type=number] { flex:1; }

@media(max-width:600px){
  h1 { font-size:28px; }
  h2 { font-size:22px; }
  select, input[type=number] { font-size:18px; }
}

body.dark-mode {
  --bg-color: #1c1c1c;
  --section-bg: #2c2c2c;
  --result-bg: #3a3a5c;
  --sticky-bg: #3a3a5c;
  --text-color: #f0f0f0;
}

#toggleTheme {
  font-size: 28px;
  padding: 20px 40px;
  border-radius: 12px;
  cursor: pointer;
  background-color: #4a90e2;
  color: #fff;
  border: none;
  margin-bottom: 20px;
}

/* Floating Calculator Widget at bottom */
.calc-widget {
  position: fixed;
  bottom: 10px;
  right: 10px;
  width: 220px;
  background: var(--section-bg);
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  border-radius: 10px;
  padding: 10px;
  z-index: 2000;
}

.calc-display {
  width: 100%;
  height: 40px;
  font-size: 20px;
  margin-bottom: 8px;
  text-align: right;
  padding: 5px;
}

.calc-buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 5px;
}

.calc-buttons button {
  padding: 12px;
  font-size: 18px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

@media(max-width:900px){
  .calc-widget {
    width: 180px;
    right: 10px;
    bottom: 10px;
  }
}
</style>
</head>
<body>

<h1>Raven’s Dox2 Trait Planner</h1>

<div style="text-align:center;">
  <button id="toggleTheme">Switch to Dark Mode</button>
</div>

<div class="section sticky-header">
  <h2>Dino Trait Power %</h2>
  <div class="result" id="finalResult">Damage: 1.0, DR: 1.0, SPD: 1.0</div>
</div>

<div class="section">
<h2>Corrupt and Greaters</h2>
<label>Corrupt String Stat:
<select id="corruptStat">
<option value="Damage">Damage</option>
<option value="DR">DR</option>
<option value="Speed">Speed</option>
</select></label>
<label>Corrupt String Bonus (%): <input type="number" id="corruptInput"></label>

<div class="flex-row">
<label>Greater String 1 Stat:
<select id="geneticStat0"></select></label>
<label>Bonus (%): <input type="number" id="geneticValue0"></label>
</div>

<div class="flex-row">
<label>Greater String 2 Stat:
<select id="geneticStat1"></select></label>
<label>Bonus (%): <input type="number" id="geneticValue1"></label>
</div>

<div class="flex-row">
<label>Greater String 3 Stat:
<select id="geneticStat2"></select></label>
<label>Bonus (%): <input type="number" id="geneticValue2"></label>
</div>
</div>

<div class="section">
<h2>Calculate Final HP</h2>
<input type="number" id="targetHP" placeholder="Enter Desired Final HP after Prime and Mega traits added">
</div>

<div class="section">
<h2>Prime & Mega Traits</h2>
<label>Prime Trait:<select id="Prime"></select></label>
<label>Mega Trait:<select id="Mega"></select></label>
</div>

<div class="section">
<h2>Wild Traits (W) – Max 3</h2>
<select id="W1"></select>
<select id="W2"></select>
<select id="W3"></select>
</div>

<div class="section">
<h2>Natural Traits (N) – Max 3</h2>
<select id="N1"></select>
<select id="N2"></select>
<select id="N3"></select>
</div>

<div class="section">
<h2>Unique Wild (UW)</h2>
<select id="UW"></select>
</div>

<div class="section">
<h2>Unique (U)</h2>
<select id="U"></select>
</div>

<div class="section">
<h2>Artificial Traits (A) – Max 3</h2>
<select id="A1"></select>
<select id="A2"></select>
<select id="A3"></select>
</div>

<!-- Floating Calculator at bottom -->
<div class="calc-widget">
  <input type="text" class="calc-display" id="calcDisplay" readonly>
  <div class="calc-buttons">
    <button onclick="calcPress('7')">7</button>
    <button onclick="calcPress('8')">8</button>
    <button onclick="calcPress('9')">9</button>
    <button onclick="calcPress('/')">÷</button>

    <button onclick="calcPress('4')">4</button>
    <button onclick="calcPress('5')">5</button>
    <button onclick="calcPress('6')">6</button>
    <button onclick="calcPress('*')">×</button>

    <button onclick="calcPress('1')">1</button>
    <button onclick="calcPress('2')">2</button>
    <button onclick="calcPress('3')">3</button>
    <button onclick="calcPress('-')">−</button>

    <button onclick="calcPress('0')">0</button>
    <button onclick="calcPress('.')">.</button>
    <button onclick="calcClear()">C</button>
    <button onclick="calcPress('+')">+</button>

    <button style="grid-column: span 4; background:#4a90e2; color:white;" onclick="calcEquals()">=</button>
  </div>
</div>

<script>
// Trait Database
const traitData = {
"W":[{N:"Tough",D:10,DR:10,S:-5},{N:"Balanced",D:7.5,DR:5,S:5},{N:"Runner",D:-5,DR:0,S:15},{N:"Brawler",D:15,DR:2.5,S:-5}],
"N":[{N:"Tough",D:0,DR:15,S:-5},{N:"Balanced",D:5,DR:0,S:5},{N:"Runner",D:-5,DR:0,S:10},{N:"Brawler",D:10,DR:5,S:-5}],
"A":[{N:"Tough",D:0,DR:5,S:-2.5},{N:"Balanced",D:2.5,DR:0,S:2.5},{N:"Runner",D:0,DR:0,S:5},{N:"Brawler",D:5,DR:2.5,S:-2.5}],
"UW":[{N:"Tough",D:15,DR:7.5,S:-5},{N:"Balanced",D:10,DR:5,S:5},{N:"Runner",D:-5,DR:0,S:15},{N:"Juggernaut",D:12.5,DR:10,S:-2.5}],
"U":[{N:"Tough",D:5,DR:15,S:-2.5},{N:"Balanced",D:10,DR:0,S:10},{N:"Runner",D:-5,DR:0,S:15},{N:"Juggernaut",D:15,DR:10,S:-5}],
"P":[{N:"Tough",D:15,DR:20,S:0},{N:"Balanced",D:20,DR:0,S:5},{N:"Runner",D:0,DR:0,S:25},{N:"Juggernaut",D:25,DR:15,S:-5}],
"M":[{N:"Tough",D:15,DR:25,S:0},{N:"Balanced",D:25,DR:0,S:7.5},{N:"Runner",D:0,DR:0,S:15},{N:"Juggernaut",D:30,DR:20,S:-5}]
};

// Populate Dropdowns
function populateDropdowns(){
  const mapping = {W:["W1","W2","W3"],N:["N1","N2","N3"],A:["A1","A2","A3"],UW:["UW"],U:["U"],P:["Prime"],M:["Mega"]};
  for(let cat in mapping){
    mapping[cat].forEach(id=>{
      const select = document.getElementById(id);
      select.innerHTML = '<option value="">--Select--</option>';
      traitData[cat].forEach((t,i)=>{
        let stats=[];
        if(t.D) stats.push(`DMG ${t.D>0?"+":""}${t.D}`);
        if(t.DR) stats.push(`DR ${t.DR>0?"+":""}${t.DR}`);
        if(t.S) stats.push(`SPD ${t.S>0?"+":""}${t.S}`);
        select.add(new Option(`${t.N} (${stats.join(", ")})`,cat+"-"+i));
      });
    });
  }
  for(let i=0;i<3;i++){
    document.getElementById("geneticStat"+i).innerHTML =
      '<option value="">--Select Stat--</option><option value="Damage">Damage</option><option value="DR">DR</option><option value="Speed">Speed</option>';
  }
}

// Calculate Dino Trait Power
function calculateFinalStats(){
  let totalBonus={Damage:0,DR:0,Speed:0};
  document.querySelectorAll("select").forEach(el=>{
    if(el.value.includes("-")){
      const [cat,i]=el.value.split("-");
      const t=traitData[cat][i];
      totalBonus.Damage+=t.D;
      totalBonus.DR+=t.DR;
      totalBonus.Speed+=t.S;
    }
  });

  totalBonus[corruptStat.value]+=parseFloat(corruptInput.value)||0;

  for(let i=0;i<3;i++){
    const stat=document.getElementById("geneticStat"+i).value;
    if(stat) totalBonus[stat]+=parseFloat(document.getElementById("geneticValue"+i).value)||0;
  }

  let drPercent=totalBonus.DR, drWarning="";
  if(drPercent>75){
    const over=(drPercent-75).toFixed(1);
    drWarning=` <span class="warning">(${over}% over cap)</span>`;
    drPercent=75;
  }

  // The multipliers (Dino Trait Power) — start at 1.0
  const dmgMult = 1 + totalBonus.Damage/100;
  const drMult = 1 - drPercent/100;
  const spdMult = 1 + totalBonus.Speed/100;

  // Target HP calculation
  const primeMultiplier=1.25, megaMultiplier=1.40;
  const targetHPInput=parseFloat(targetHP.value);
  let levelHP=null;
  if(targetHPInput) levelHP=targetHPInput/(primeMultiplier*megaMultiplier);

  // Update the result box
  let output=`Damage: ${dmgMult.toFixed(3)}, DR: ${drMult.toFixed(3)}${drWarning}, SPD: ${spdMult.toFixed(3)}`;
  if(levelHP) output+=`<br><b>Level HP to ~</b>${Math.round(levelHP)} before Prime & Mega`;
  finalResult.innerHTML=output;
}

// Event Listeners
document.querySelectorAll("select").forEach(el=>el.addEventListener("change",calculateFinalStats));
document.querySelectorAll("input[type=number]").forEach(el=>el.addEventListener("input",calculateFinalStats));

// Theme Toggle
toggleTheme.onclick=()=>{
  document.body.classList.toggle("dark-mode");
  toggleTheme.textContent=document.body.classList.contains("dark-mode")?"Switch to Light Mode":"Switch to Dark Mode";
};

// Mini Calculator
function calcPress(val){calcDisplay.value+=val;}
function calcClear(){calcDisplay.value="";}
function calcEquals(){try{calcDisplay.value=eval(calcDisplay.value);}catch{calcDisplay.value="Error";}}

// Initialize
window.onload=()=>{populateDropdowns();calculateFinalStats();}
</script>
</body>
</html>